<!DOCTYPE html>
<html lang="en">

    {% include "partials/header.html" %}

    <body>

        {% set founder_name = siteinfo[0].bioname %}
        {% set founder_bio = siteinfo[0].bio %}
        {% set founder_photo = siteinfo[0].biophoto %}
        {% set mission = siteinfo[0].mission %}
        {% set vision = siteinfo[0].vision %}
        {% set description = siteinfo[0].description %}
        {% set telephone = siteinfo[0].telephone %}
        {% set company_email = siteinfo[0].email %}
        {% set company_address = siteinfo[0].address %}
        {% set logo = siteinfo[0].logo %}
        {% set facebook_url = siteinfo[0].socialmedia.facebook %}
        {% set twitter_url = siteinfo[0].socialmedia.twitter %}
        {% set instagram_url = siteinfo[0].socialmedia.instagram %}

        <div class="site-wrap">
            {% include "partials/nav.html" %}

            {% block content %}{% endblock %}

            {% include "partials/footer.njk" %}
        </div>

        <!-- Bootstrap core JavaScript -->

        
        <script src="/assets/js/jquery-3.3.1.min.js"></script>
        <script src="/assets/js/jquery-ui.js"></script>
        <script src="/assets/js/popper.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>
        <script src="/assets/js/owl.carousel.min.js"></script>
        <script src="/assets/js/jquery.magnific-popup.min.js"></script>
        <script src="/assets/js/aos.js"></script>

        <script src="/assets/js/main.js"></script>
        <script>
            if (window.netlifyIdentity) {
                window
                    .netlifyIdentity
                    .on("init", user => {
                        if (!user) {
                            window
                                .netlifyIdentity
                                .on("login", () => {
                                    document.location.href = "/admin/";
                                });
                        }
                    });
            }
        </script>
        <script>

            var items = [];
            var products = [];
            $.getJSON("/assets/data/products.json", function (data) {

                console.log(data);
                localStorage.setItem('products',JSON.stringify(data))
                //$.each(data, function (key, val) {
                //    items.push(data)
                //});

                //console.log(items)
                //products = items[0].products;
                //console.log(products)
            });

            var infoModal = $("#myModal");
            $(".openModal").on("click", function () {
                console.log(this.value);
                var product_id = parseInt(this.value) - 1
                console.log(products[product_id])
                // htmlData = $(this)
                //   .find(".profile")
                //   .html();
                infoModal
                    .find(".modal-title")
                    .html(products[product_id].name);
                infoModal
                    .find(".modal-description")
                    .html(products[product_id].ingredients);
                infoModal
                    .find(".product-directions")
                    .html(products[product_id].directions);
                infoModal
                    .find(".product-disclaimer")
                    .html(products[product_id].disclaimer);
                infoModal.modal("show");
                return false;
            });
        </script>
        <script>

        function addToCart(){
            var product_id = document.getElementById("item_id").innerHTML;
            console.log('clicked on product with id: ', product_id)

            var products = JSON.parse(localStorage.getItem('products'))
            console.log('current product', products[product_id])
            //return;
            var product_info = products[product_id]

            //console.log(id, name, price, sku)
            var item_quantity = document.getElementById("item_quantity").value;
            console.log(item_quantity)

            var data_array = JSON.parse(localStorage.getItem("cart_items"))
            console.log(data_array)

            if(!data_array){
                data_array = []
            }

            data_array.push({
                id: product_info.id,
                sku: product_info.stripe_sku,
                image:"",
                product: product_info.title,
                price: product_info.price,
                quantity: item_quantity
            });

            localStorage.setItem("cart_items",JSON.stringify(data_array))

            window.location = 'cart.html'

        }


        </script>

        <script>

            /*var item_array = [
                {
                    image:"",
                    product:"Crop Top",
                    price:"39.31",
                    quantity:"1"
                },{
                    image:"",
                    product:"Shirt",
                    price:"49.2",
                    quantity:"2"
                }
            ];

            console.log(JSON.stringify({ x: 5, y: 6 }));

            localStorage.setItem("cart_items",JSON.stringify(item_array))*/
            var data_array = JSON.parse(localStorage.getItem("cart_items"))
            console.log(data_array)

            

            var table = document.getElementById("shopping-cart");

            var total_cost = 0;


            for(var i=0; i<data_array.length; i++){

                // Create an empty <tr> element and add it to the 1st position of the table:
                var row = table.insertRow(-1);

                // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);

                // Add some text to the new cells:
                cell1.innerHTML = data_array[i].image;
                cell2.innerHTML = data_array[i].product;
                cell3.innerHTML = "$ "+parseFloat(data_array[i].price).toFixed(2);
                cell4.innerHTML = data_array[i].quantity;

                total_cost += parseFloat(data_array[i].price)*parseFloat(data_array[i].quantity)
            }

            console.log(total_cost)

            document.getElementById('sub_total').innerHTML = "$ "+parseFloat(total_cost).toFixed(2)
            document.getElementById('final_total').innerHTML = "$ "+parseFloat(total_cost).toFixed(2)

            
        </script>

        <!-- Load Stripe.js on your website. -->
        <script src="https://js.stripe.com/v3"></script>
        
        <script>
            (function () {
              //var stripe = Stripe('pk_test_ujOhdb12UPkmWbya4ghecbTW');
              //var stripe = Stripe('pk_live_HEnlS2Pd3aY9uYctGiws23fs');
              // Richieann
              var stripe = Stripe('pk_live_6JxSfq1ltlJKfDJfMj2cTGNn00fmKxrq3i');

              var checkoutButton = document.getElementById('checkout-button-sku_GZ2BWHOxgx2TSg');
              checkoutButton.addEventListener('click', function () {
                // When the customer clicks on the button, redirect
                // them to Checkout.
                stripe.redirectToCheckout({
                  
                  //live items
                  //items: [{ sku: 'sku_GZ2BWHOxgx2TSg', quantity: 1 }],
                  //Richieann
                  items: [{ sku: 'sku_GZ5MJ23DUG6rCH', quantity: 1 }],
                  //test items
                  //items: [{ sku: 'sku_GeHtCV10DKJRZn', quantity: 1 },{sku: 'sku_GeINSvjcP8C0ck', quantity: 1}],

                  // Do not rely on the redirect to the successUrl for fulfilling
                  // purchases, customers may not always reach the success_url after
                  // a successful payment.
                  // Instead use one of the strategies described in
                  // https://stripe.com/docs/payments/checkout/fulfillment
                  successUrl: 'https://sunniesbyrichie.com/success.html',
                  cancelUrl: 'https://sunniesbyrichie.com/cancelled.html',
                })
                  .then(function (result) {
                    if (result.error) {
                      // If `redirectToCheckout` fails due to a browser or network
                      // error, display the localized error message to your customer.
                      var displayError = document.getElementById('error-message');
                      displayError.textContent = result.error.message;
                    }
                  });
              });
            })();
          </script>
    </body>
</html>